<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¦¬ë·°ëª¨ìŒ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 1000px;
            width: 100%;
        }
        
        h1 {
            color: #ff6b6b;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-align: center;
        }
        
        .reviews-container {
            max-height: 600px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .review-item {
            background: #f9f9f9;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #ff6b6b;
            transition: all 0.3s ease;
        }
        
        .review-item:hover {
            background: #f5f5f5;
        }
        
        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .review-rating {
            display: flex;
            gap: 5px;
        }
        
        .review-rating .star {
            font-size: 1.5em;
            color: #ffd700;
        }
        
        .review-date {
            color: #999;
            font-size: 0.9em;
        }
        
        .review-content {
            color: #333;
            font-size: 1.1em;
            line-height: 1.6;
            text-align: left;
            margin-bottom: 15px;
        }
        
        .reply-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
        }
        
        .reply-list {
            margin-bottom: 10px;
        }
        
        .reply-item {
            background: white;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 8px;
            border-left: 3px solid #4ecdc4;
        }
        
        .reply-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .reply-author {
            font-weight: 600;
            color: #4ecdc4;
            font-size: 0.9em;
        }
        
        .reply-date {
            color: #999;
            font-size: 0.85em;
        }
        
        .reply-content {
            color: #555;
            font-size: 0.95em;
            text-align: left;
        }
        
        .reply-form {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .reply-form textarea {
            flex: 1;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            resize: vertical;
            min-height: 60px;
        }
        
        .reply-form textarea:focus {
            outline: none;
            border-color: #4ecdc4;
        }
        
        .reply-btn {
            padding: 10px 20px;
            background: #4ecdc4;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .reply-btn:hover {
            background: #44a08d;
            transform: translateY(-2px);
        }
        
        .empty-message {
            text-align: center;
            padding: 40px;
            color: #999;
            font-size: 1.2em;
        }
        
        .back-btn {
            display: inline-block;
            margin-top: 30px;
            padding: 12px 30px;
            background: #ff6b6b;
            color: white;
            text-decoration: none;
            border-radius: 25px;
            transition: all 0.3s ease;
            width: 100%;
            text-align: center;
        }
        
        .back-btn:hover {
            background: #ee5a6f;
            transform: translateY(-2px);
        }
        
        .refresh-btn {
            display: inline-block;
            margin-bottom: 20px;
            padding: 10px 20px;
            background: #ff6b6b;
            color: white;
            text-decoration: none;
            border-radius: 20px;
            font-size: 0.9em;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
        }
        
        .refresh-btn:hover {
            background: #ee5a6f;
            transform: translateY(-2px);
        }
        
        .settings-section {
            background: #fff9f9;
            border: 2px solid #ff6b6b;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .settings-title {
            color: #ff6b6b;
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .settings-form {
            display: flex;
            gap: 10px;
        }
        
        .settings-form input,
        .settings-form textarea {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            resize: vertical;
        }
        
        .settings-form textarea {
            min-height: 100px;
        }
        
        .settings-form input:focus,
        .settings-form textarea:focus {
            outline: none;
            border-color: #ff6b6b;
        }
        
        .save-btn {
            padding: 12px 25px;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .save-btn:hover {
            background: #ee5a6f;
            transform: translateY(-2px);
        }
        
        .settings-info {
            margin-top: 10px;
            color: #666;
            font-size: 1.17em;
        }
        
        .toggle-section {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .toggle-label {
            font-size: 1.1em;
            color: #333;
            font-weight: 600;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 30px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        .toggle-switch input:checked + .toggle-slider {
            background-color: #ff6b6b;
        }
        
        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }
        
        .toggle-status {
            font-size: 1.1em;
            font-weight: 600;
            padding: 5px 15px;
            border-radius: 20px;
        }
        
        .toggle-status.active {
            color: #ff6b6b;
            background: #fff9f9;
        }
        
        .toggle-status.inactive {
            color: #999;
            background: #f5f5f5;
        }
        
        .delay-section {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .delay-label {
            font-size: 1.1em;
            color: #333;
            font-weight: 600;
        }
        
        .delay-buttons {
            display: flex;
            gap: 8px;
        }
        
        .delay-btn {
            padding: 8px 20px;
            border: 2px solid #ff6b6b;
            background: white;
            color: #ff6b6b;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 0.95em;
        }
        
        .delay-btn:hover {
            background: #fff9f9;
            transform: translateY(-2px);
        }
        
        .delay-btn.selected {
            background: #ff6b6b;
            color: white;
        }
        
        .delay-info {
            font-size: 1em;
            color: #666;
            margin-left: auto;
        }
        
        .filter-section {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }
        
        .filter-btn {
            padding: 10px 25px;
            border: 2px solid #ff6b6b;
            background: white;
            color: #ff6b6b;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 1em;
        }
        
        .filter-btn:hover {
            background: #fff9f9;
            transform: translateY(-2px);
        }
        
        .filter-btn.active {
            background: #ff6b6b;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒŸ ë¦¬ë·°ëª¨ìŒ</h1>
        
        <div class="filter-section">
            <button class="filter-btn active" onclick="setFilter('all')" id="filterAll">ì „ì²´ë³´ê¸°</button>
            <button class="filter-btn" onclick="setFilter('pending')" id="filterPending">ë“±ë¡ëŒ€ê¸° <span id="pendingCount" style="margin-left: 5px;"></span></button>
        </div>
        
        <div class="settings-section">
            <div class="settings-title">âš™ï¸ ìë™ ë‹µê¸€ ê³ ì • ë¬¸êµ¬ ì„¤ì •</div>
            <div class="toggle-section" style="margin-bottom: 15px;">
                <span class="toggle-label">ê°ì • ê¸°ë°˜ ìë™ ë‹µê¸€:</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="aiReplyToggle" onchange="toggleAIReply()">
                    <span class="toggle-slider"></span>
                </label>
                <span class="toggle-status inactive" id="aiToggleStatus">OFF</span>
            </div>
            <div class="toggle-section">
                <span class="toggle-label">ìë™ ë‹µê¸€ í™œì„±í™”:</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="autoReplyToggle" onchange="toggleAutoReply()">
                    <span class="toggle-slider"></span>
                </label>
                <span class="toggle-status inactive" id="toggleStatus">OFF</span>
            </div>
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">ê°€ê²Œ ì„ íƒ:</label>
                <select id="storeSelect" style="width: 100%; padding: 10px; border: 2px solid #ff6b6b; border-radius: 10px; font-size: 1em;" onchange="loadStoreAutoReply()">
                    <option value="ALL">ì „ì²´ ê°€ê²Œ</option>
                </select>
            </div>
            <div class="delay-section">
                <span class="delay-label">ì§€ì—° ì‹œê°„:</span>
                <div class="delay-buttons">
                    <button class="delay-btn" data-minutes="0" onclick="selectDelay(0)">ì§€ì—°ì‹œê°„ ì—†ìŒ</button>
                    <button class="delay-btn" data-minutes="1" onclick="selectDelay(1)">1ë¶„</button>
                    <button class="delay-btn" data-minutes="5" onclick="selectDelay(5)">5ë¶„</button>
                    <button class="delay-btn" data-minutes="10" onclick="selectDelay(10)">10ë¶„</button>
                </div>
                <span class="delay-info">ì„ íƒ: <span id="selectedDelay">ì—†ìŒ</span></span>
            </div>
            <div class="settings-form">
                <textarea id="autoReplyText" placeholder="ìƒˆ ë¦¬ë·°ì— ìë™ìœ¼ë¡œ ë‹¬ë¦´ ë‹µê¸€ ë¬¸êµ¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                <button class="save-btn" onclick="saveAutoReply()">ì €ì¥</button>
            </div>
            <div class="settings-info" id="settingsInfo">
                í˜„ì¬ ì„¤ì •ëœ ë¬¸êµ¬: <span id="currentSetting">ì—†ìŒ</span>
            </div>
        </div>
        
        <button class="refresh-btn" onclick="loadReviews()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        
        <div class="reviews-container" id="reviewsContainer">
            <div class="empty-message">ì•„ì§ ì‘ì„±ëœ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
        </div>
        
        <a href="index.html" class="back-btn">â† ë©”ì¸ ë©”ë‰´ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>
    
    <script>
        // í˜„ì¬ í•„í„° ìƒíƒœ
        let currentFilter = 'all';
        
        // ì§€ì—°ëœ ìë™ ë‹µê¸€ ì²´í¬ í•¨ìˆ˜
        function checkPendingAutoReplies() {
            const storedReviews = localStorage.getItem('reviews');
            const storedGit2Reviews = localStorage.getItem('git2_reviews');
            const connectedStores = JSON.parse(localStorage.getItem('so4_connectedStores') || '[]');
            
            let hasChanges = false;
            let git2HasChanges = false;
            const now = Date.now();
            
            // ì¼ë°˜ ë¦¬ë·° ì²´í¬
            if (storedReviews) {
                const reviews = JSON.parse(storedReviews);
                reviews.forEach(review => {
                    // 1ì°¨ ìë™ ë‹µê¸€ ì²´í¬
                    if (review.pendingAutoReply) {
                        if (now >= review.pendingAutoReply.scheduledTime) {
                            const autoReply = {
                                id: now + Math.random(),
                                author: 'ê´€ë¦¬ì',
                                content: review.pendingAutoReply.text,
                                date: new Date().toLocaleString('ko-KR'),
                                isAuto: true
                            };
                            
                            if (!review.replies) {
                                review.replies = [];
                            }
                            review.replies.push(autoReply);
                            delete review.pendingAutoReply;
                            hasChanges = true;
                            
                            // 1ì°¨ ë‹µê¸€ ì¶”ê°€ í›„ 2ì°¨ ë‹µê¸€ ìŠ¤ì¼€ì¤„ë§
                            scheduleSecondReply(review);
                        }
                    }
                    
                    // 2ì°¨ ìë™ ë‹µê¸€ ì²´í¬
                    if (review.pendingSecondReply) {
                        if (now >= review.pendingSecondReply.scheduledTime) {
                            const secondReply = {
                                id: now + Math.random(),
                                author: 'ê´€ë¦¬ì',
                                content: review.pendingSecondReply.text,
                                date: new Date().toLocaleString('ko-KR'),
                                isAuto: true
                            };
                            
                            if (!review.replies) {
                                review.replies = [];
                            }
                            review.replies.push(secondReply);
                            delete review.pendingSecondReply;
                            hasChanges = true;
                        }
                    }
                });
                
                if (hasChanges) {
                    localStorage.setItem('reviews', JSON.stringify(reviews));
                }
            }
            
            // git2 ë¦¬ë·° ì²´í¬ (ì—°ê²°ëœ ê°€ê²Œë§Œ)
            if (storedGit2Reviews && connectedStores.length > 0) {
                const git2Reviews = JSON.parse(storedGit2Reviews);
                git2Reviews.forEach(review => {
                    if (connectedStores.includes(review.storeId)) {
                        // 1ì°¨ ìë™ ë‹µê¸€ ì²´í¬
                        if (review.pendingAutoReply) {
                            if (now >= review.pendingAutoReply.scheduledTime) {
                                const autoReply = {
                                    id: now + Math.random(),
                                    userName: 'ê´€ë¦¬ì',
                                    content: review.pendingAutoReply.text,
                                    createdAt: new Date().toISOString(),
                                    isAuto: true
                                };
                                
                                if (!review.replies) {
                                    review.replies = [];
                                }
                                review.replies.push(autoReply);
                                delete review.pendingAutoReply;
                                git2HasChanges = true;
                                
                                // 1ì°¨ ë‹µê¸€ ì¶”ê°€ í›„ 2ì°¨ ë‹µê¸€ ìŠ¤ì¼€ì¤„ë§
                                scheduleSecondReplyForGit2(review);
                            }
                        }
                        
                        // 2ì°¨ ìë™ ë‹µê¸€ ì²´í¬
                        if (review.pendingSecondReply) {
                            if (now >= review.pendingSecondReply.scheduledTime) {
                                const secondReply = {
                                    id: now + Math.random(),
                                    userName: 'ê´€ë¦¬ì',
                                    content: review.pendingSecondReply.text,
                                    createdAt: new Date().toISOString(),
                                    isAuto: true
                                };
                                
                                if (!review.replies) {
                                    review.replies = [];
                                }
                                review.replies.push(secondReply);
                                delete review.pendingSecondReply;
                                git2HasChanges = true;
                            }
                        }
                    }
                });
                
                if (git2HasChanges) {
                    localStorage.setItem('git2_reviews', JSON.stringify(git2Reviews));
                }
            }
            
            if (hasChanges || git2HasChanges) {
                updatePendingCount();
            }
        }
        
        // 2ì°¨ ë‹µê¸€ ìŠ¤ì¼€ì¤„ë§ í•¨ìˆ˜ (ì¼ë°˜ ë¦¬ë·°)
        function scheduleSecondReply(review) {
            const secondReplyDelay = localStorage.getItem('secondReplyDelay');
            const secondReplyText = localStorage.getItem('secondReplyText');
            const storeSecondReplies = JSON.parse(localStorage.getItem('storeSecondReplies') || '{}');
            
            if (!secondReplyDelay || !secondReplyText) {
                return;
            }
            
            const delayMinutes = parseInt(secondReplyDelay);
            if (!delayMinutes || delayMinutes <= 0) {
                return;
            }
            
            review.pendingSecondReply = {
                text: secondReplyText.trim(),
                delayMinutes: delayMinutes,
                scheduledTime: Date.now() + (delayMinutes * 60 * 1000)
            };
        }
        
        // 2ì°¨ ë‹µê¸€ ìŠ¤ì¼€ì¤„ë§ í•¨ìˆ˜ (git2 ë¦¬ë·°)
        function scheduleSecondReplyForGit2(review) {
            const secondReplyDelay = localStorage.getItem('secondReplyDelay');
            const storeSecondReplies = JSON.parse(localStorage.getItem('storeSecondReplies') || '{}');
            const secondReplyText = localStorage.getItem('secondReplyText');
            
            if (!secondReplyDelay) {
                return;
            }
            
            const delayMinutes = parseInt(secondReplyDelay);
            if (!delayMinutes || delayMinutes <= 0) {
                return;
            }
            
            // ê°€ê²Œë³„ ë¬¸êµ¬ê°€ ìˆìœ¼ë©´ ìš°ì„  ì‚¬ìš©, ì—†ìœ¼ë©´ ì „ì²´ ë¬¸êµ¬ ì‚¬ìš©
            const text = storeSecondReplies[review.storeId] || secondReplyText;
            if (!text) {
                return;
            }
            
            review.pendingSecondReply = {
                text: text.trim(),
                delayMinutes: delayMinutes,
                scheduledTime: Date.now() + (delayMinutes * 60 * 1000)
            };
        }
        
        // í•„í„° ì„¤ì • í•¨ìˆ˜
        function setFilter(filterType) {
            currentFilter = filterType;
            
            // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.getElementById('filterAll').classList.remove('active');
            document.getElementById('filterPending').classList.remove('active');
            
            if (filterType === 'all') {
                document.getElementById('filterAll').classList.add('active');
            } else {
                document.getElementById('filterPending').classList.add('active');
            }
            
            // ë¦¬ë·° ë‹¤ì‹œ ë¡œë“œ
            loadReviews();
        }
        
        // ë¦¬ë·° ë¡œë“œ í•¨ìˆ˜
        function loadReviews() {
            // ë¨¼ì € ì§€ì—°ëœ ìë™ ë‹µê¸€ ì²´í¬
            checkPendingAutoReplies();
            
            const container = document.getElementById('reviewsContainer');
            
            // localStorageì—ì„œ ë¦¬ë·° ê°€ì ¸ì˜¤ê¸°
            const storedReviews = localStorage.getItem('reviews');
            const storedGit2Reviews = localStorage.getItem('git2_reviews');
            const connectedStores = JSON.parse(localStorage.getItem('so4_connectedStores') || '[]');
            
            let reviews = [];
            
            // ì¼ë°˜ ë¦¬ë·° ë¡œë“œ
            if (storedReviews) {
                const parsedReviews = JSON.parse(storedReviews);
                reviews = reviews.concat(parsedReviews);
            }
            
            // ì—°ê²°ëœ ê°€ê²Œì˜ ë¦¬ë·° ë¡œë“œ (git2)
            if (storedGit2Reviews && connectedStores.length > 0) {
                const parsedGit2Reviews = JSON.parse(storedGit2Reviews);
                const filteredGit2Reviews = parsedGit2Reviews.filter(review => 
                    connectedStores.includes(review.storeId)
                );
                reviews = reviews.concat(filteredGit2Reviews);
            }
            
            // ë¦¬ë·°ê°€ ì—†ìœ¼ë©´
            if (reviews.length === 0) {
                container.innerHTML = '<div class="empty-message">ì•„ì§ ì‘ì„±ëœ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            // í•„í„° ì ìš©
            if (currentFilter === 'pending') {
                // ë‹µê¸€ì´ ì—†ê±°ë‚˜, ìë™ ë‹µê¸€ì´ ì•„ì§ ë‹¬ë¦¬ì§€ ì•Šì€ ë¦¬ë·°ë§Œ í‘œì‹œ
                reviews = reviews.filter(review => {
                    const hasReplies = review.replies && review.replies.length > 0;
                    const hasPendingAutoReply = review.pendingAutoReply && Date.now() < review.pendingAutoReply.scheduledTime;
                    return !hasReplies || hasPendingAutoReply;
                });
            }
            
            // ì‹œê°„ìˆœ ì •ë ¬ (ìµœì‹ ìˆœ)
            reviews.sort((a, b) => {
                const aTime = a.createdAt ? new Date(a.createdAt).getTime() : a.timestamp || 0;
                const bTime = b.createdAt ? new Date(b.createdAt).getTime() : b.timestamp || 0;
                return bTime - aTime;
            });
            
            if (reviews.length === 0) {
                container.innerHTML = '<div class="empty-message">ì¡°ê±´ì— ë§ëŠ” ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            // ë¦¬ë·° ëª©ë¡ ìƒì„±
            let reviewsHTML = '';
            reviews.forEach(review => {
                // ë³„ì  í‘œì‹œ
                let starsHTML = '';
                for (let i = 1; i <= 5; i++) {
                    if (i <= review.rating) {
                        starsHTML += '<span class="star">â˜…</span>';
                    } else {
                        starsHTML += '<span class="star" style="color: #ddd;">â˜…</span>';
                    }
                }
                
                // ë‹µê¸€ ëª©ë¡ ìƒì„±
                let repliesHTML = '';
                if (review.replies && review.replies.length > 0) {
                    review.replies.forEach(reply => {
                        // git2 ë¦¬ë·°ì¸ ê²½ìš° userNameê³¼ createdAt ì‚¬ìš©
                        const replyAuthor = reply.author || reply.userName;
                        const replyDate = reply.date || (reply.createdAt ? new Date(reply.createdAt).toLocaleString('ko-KR') : '');
                        const replyContent = (reply.content || '').replace(/\n/g, '<br>');
                        
                        repliesHTML += `
                            <div class="reply-item">
                                <div class="reply-header">
                                    <span class="reply-author">ğŸ‘¤ ${replyAuthor}</span>
                                    <span class="reply-date">${replyDate}</span>
                                </div>
                                <div class="reply-content">${replyContent}</div>
                            </div>
                        `;
                    });
                }
                
                // ë‚ ì§œ í¬ë§·íŒ…
                const reviewDate = review.date || (review.createdAt ? new Date(review.createdAt).toLocaleString('ko-KR') : 'ë‚ ì§œ ì •ë³´ ì—†ìŒ');
                
                // ê°€ê²Œëª… í‘œì‹œ (git2 ë¦¬ë·°ì¸ ê²½ìš°)
                const storeNameInfo = review.storeName ? `<div style="color: #667eea; font-weight: 600; margin-bottom: 5px;">ğŸª ${review.storeName}</div>` : '';
                
                // ì†ŒìŠ¤ êµ¬ë¶„ (ì¼ë°˜ ë¦¬ë·°ì¸ì§€ git2 ë¦¬ë·°ì¸ì§€)
                const isGit2Review = !!review.storeName;
                
                reviewsHTML += `
                    <div class="review-item">
                        <div class="review-header">
                            <div class="review-rating">
                                ${starsHTML}
                            </div>
                            <div class="review-date">${reviewDate}</div>
                        </div>
                        ${storeNameInfo}
                        <div class="review-content">${review.content}</div>
                        <div class="reply-section">
                            <div class="reply-list">
                                ${repliesHTML}
                            </div>
                            <div class="reply-form">
                                <textarea id="replyText_${review.id}" placeholder="ë‹µê¸€ì„ ì‘ì„±í•˜ì„¸ìš”..."></textarea>
                                <button class="reply-btn" onclick="addReply('${review.id}', ${isGit2Review})">ë‹µê¸€</button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = reviewsHTML;
            
            // ë“±ë¡ëŒ€ê¸° ê°œìˆ˜ ì—…ë°ì´íŠ¸
            updatePendingCount();
        }
        
        // ë‹µê¸€ ì¶”ê°€ í•¨ìˆ˜
        function addReply(reviewId, isGit2Review) {
            const replyTextArea = document.getElementById(`replyText_${reviewId}`);
            const replyContent = replyTextArea.value.trim();
            
            if (replyContent === '') {
                alert('ë‹µê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ë‹µê¸€ ë°ì´í„° ìƒì„±
            const replyData = {
                id: Date.now(),
                author: 'ê´€ë¦¬ì',
                content: replyContent,
                date: new Date().toLocaleString('ko-KR')
            };
            
            if (isGit2Review) {
                // git2 ë¦¬ë·°ì¸ ê²½ìš°
                const storedGit2Reviews = localStorage.getItem('git2_reviews');
                if (!storedGit2Reviews) return;
                
                const git2Reviews = JSON.parse(storedGit2Reviews);
                
                // í•´ë‹¹ ë¦¬ë·° ì°¾ê¸°
                const review = git2Reviews.find(r => r.id === reviewId);
                if (!review) return;
                
                // ë‹µê¸€ ì¶”ê°€
                if (!review.replies) {
                    review.replies = [];
                }
                review.replies.push(replyData);
                
                // localStorageì— ì €ì¥
                localStorage.setItem('git2_reviews', JSON.stringify(git2Reviews));
            } else {
                // ì¼ë°˜ ë¦¬ë·°ì¸ ê²½ìš°
                const storedReviews = localStorage.getItem('reviews');
                if (!storedReviews) return;
                
                const reviews = JSON.parse(storedReviews);
                
                // í•´ë‹¹ ë¦¬ë·° ì°¾ê¸°
                const review = reviews.find(r => r.id == reviewId);
                if (!review) return;
                
                // ë‹µê¸€ ì¶”ê°€
                if (!review.replies) {
                    review.replies = [];
                }
                review.replies.push(replyData);
                
                // localStorageì— ì €ì¥
                localStorage.setItem('reviews', JSON.stringify(reviews));
            }
            
            // UI ìƒˆë¡œê³ ì¹¨
            loadReviews();
            updatePendingCount();
            
            alert('ë‹µê¸€ì´ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }
        
        // ìë™ ë‹µê¸€ ê³ ì • ë¬¸êµ¬ ì €ì¥ í•¨ìˆ˜
        function saveAutoReply() {
            const autoReplyText = document.getElementById('autoReplyText').value.trim();
            const selectedStore = document.getElementById('storeSelect').value;
            
            if (autoReplyText === '') {
                alert('ë‹µê¸€ ë¬¸êµ¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (selectedStore === 'ALL') {
                // ì „ì²´ ê°€ê²Œìš©
                localStorage.setItem('autoReplyText', autoReplyText);
            } else {
                // íŠ¹ì • ê°€ê²Œìš©
                const storeAutoReplies = JSON.parse(localStorage.getItem('storeAutoReplies') || '{}');
                storeAutoReplies[selectedStore] = autoReplyText;
                localStorage.setItem('storeAutoReplies', JSON.stringify(storeAutoReplies));
            }
            
            document.getElementById('currentSetting').textContent = autoReplyText;
            document.getElementById('autoReplyText').value = '';
            alert('ìë™ ë‹µê¸€ ë¬¸êµ¬ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }
        
        // ìë™ ë‹µê¸€ ê³ ì • ë¬¸êµ¬ ë¡œë“œ í•¨ìˆ˜
        function loadStoreAutoReply() {
            const selectedStore = document.getElementById('storeSelect').value;
            
            if (selectedStore === 'ALL') {
                const storedAutoReply = localStorage.getItem('autoReplyText');
                document.getElementById('currentSetting').textContent = storedAutoReply || 'ì—†ìŒ';
            } else {
                const storeAutoReplies = JSON.parse(localStorage.getItem('storeAutoReplies') || '{}');
                document.getElementById('currentSetting').textContent = storeAutoReplies[selectedStore] || 'ì—†ìŒ';
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ë‹µê¸€ ë¬¸êµ¬ ë¡œë“œ
        function loadAutoReply() {
            loadStoreAutoReply();
        }
        
        // ê°€ê²Œ ëª©ë¡ ë¡œë“œ í•¨ìˆ˜
        function loadStoreList() {
            const connectedStores = JSON.parse(localStorage.getItem('so4_connectedStores') || '[]');
            const allStores = JSON.parse(localStorage.getItem('git2_stores') || '[]');
            const select = document.getElementById('storeSelect');
            
            // ê¸°ì¡´ ì˜µì…˜ ì œê±° (ì „ì²´ ê°€ê²Œ ì œì™¸)
            while (select.options.length > 1) {
                select.remove(1);
            }
            
            // ì—°ê²°ëœ ê°€ê²Œë§Œ ì¶”ê°€
            connectedStores.forEach(storeId => {
                const store = allStores.find(s => s.id === storeId);
                if (store) {
                    const option = document.createElement('option');
                    option.value = storeId;
                    option.textContent = store.name;
                    select.appendChild(option);
                }
            });
        }
        
        // ìë™ ë‹µê¸€ í† ê¸€ í•¨ìˆ˜
        function toggleAutoReply() {
            const toggle = document.getElementById('autoReplyToggle');
            const status = document.getElementById('toggleStatus');
            
            if (toggle.checked) {
                status.textContent = 'ON';
                status.classList.remove('inactive');
                status.classList.add('active');
                localStorage.setItem('autoReplyEnabled', 'true');
            } else {
                status.textContent = 'OFF';
                status.classList.remove('active');
                status.classList.add('inactive');
                localStorage.setItem('autoReplyEnabled', 'false');
            }
        }
        
        // ìë™ ë‹µê¸€ í† ê¸€ ìƒíƒœ ë¡œë“œ í•¨ìˆ˜
        function loadToggleState() {
            const enabled = localStorage.getItem('autoReplyEnabled');
            const toggle = document.getElementById('autoReplyToggle');
            const status = document.getElementById('toggleStatus');
            
            if (enabled === 'true') {
                toggle.checked = true;
                status.textContent = 'ON';
                status.classList.remove('inactive');
                status.classList.add('active');
            } else {
                toggle.checked = false;
                status.textContent = 'OFF';
                status.classList.remove('active');
                status.classList.add('inactive');
            }
        }
        
        // ê°ì • ê¸°ë°˜ ìë™ ë‹µê¸€ í† ê¸€ í•¨ìˆ˜
        function toggleAIReply() {
            const toggle = document.getElementById('aiReplyToggle');
            const status = document.getElementById('aiToggleStatus');
            
            if (toggle.checked) {
                status.textContent = 'ON';
                status.classList.remove('inactive');
                status.classList.add('active');
                localStorage.setItem('aiReplyEnabled', 'true');
            } else {
                status.textContent = 'OFF';
                status.classList.remove('active');
                status.classList.add('inactive');
                localStorage.setItem('aiReplyEnabled', 'false');
            }
        }
        
        // ê°ì • ê¸°ë°˜ ìë™ ë‹µê¸€ í† ê¸€ ìƒíƒœ ë¡œë“œ í•¨ìˆ˜
        function loadAIToggleState() {
            const enabled = localStorage.getItem('aiReplyEnabled');
            const toggle = document.getElementById('aiReplyToggle');
            const status = document.getElementById('aiToggleStatus');
            
            if (enabled === 'true') {
                toggle.checked = true;
                status.textContent = 'ON';
                status.classList.remove('inactive');
                status.classList.add('active');
            } else {
                toggle.checked = false;
                status.textContent = 'OFF';
                status.classList.remove('active');
                status.classList.add('inactive');
            }
        }
        
        // ì§€ì—° ì‹œê°„ ì„ íƒ í•¨ìˆ˜
        function selectDelay(minutes) {
            // ëª¨ë“  ë²„íŠ¼ì˜ ì„ íƒ ìƒíƒœ ì œê±°
            const buttons = document.querySelectorAll('.delay-btn');
            buttons.forEach(btn => btn.classList.remove('selected'));
            
            // ì„ íƒëœ ë²„íŠ¼ ì°¾ì•„ì„œ selected í´ë˜ìŠ¤ ì¶”ê°€
            buttons.forEach(btn => {
                if (btn.getAttribute('data-minutes') == minutes) {
                    btn.classList.add('selected');
                }
            });
            
            // localStorageì— ì €ì¥ (ë¬¸ìì—´ë¡œ ë³€í™˜)
            localStorage.setItem('autoReplyDelay', String(minutes));
            
            // UI ì—…ë°ì´íŠ¸
            if (minutes === 0) {
                document.getElementById('selectedDelay').textContent = 'ì§€ì—°ì‹œê°„ ì—†ìŒ';
            } else {
                document.getElementById('selectedDelay').textContent = minutes + 'ë¶„';
            }
        }
        
        // ì§€ì—° ì‹œê°„ ìƒíƒœ ë¡œë“œ í•¨ìˆ˜
        function loadDelayState() {
            const delay = localStorage.getItem('autoReplyDelay');
            const buttons = document.querySelectorAll('.delay-btn');
            
            if (delay !== null) {
                buttons.forEach(btn => {
                    if (parseInt(btn.getAttribute('data-minutes')) === parseInt(delay)) {
                        btn.classList.add('selected');
                    }
                });
                
                if (delay === '0') {
                    document.getElementById('selectedDelay').textContent = 'ì§€ì—°ì‹œê°„ ì—†ìŒ';
                } else {
                    document.getElementById('selectedDelay').textContent = delay + 'ë¶„';
                }
            }
        }
        
        // ë“±ë¡ëŒ€ê¸° ë¦¬ë·° ê°œìˆ˜ ê³„ì‚° í•¨ìˆ˜
        function updatePendingCount() {
            const storedReviews = localStorage.getItem('reviews');
            const storedGit2Reviews = localStorage.getItem('git2_reviews');
            const connectedStores = JSON.parse(localStorage.getItem('so4_connectedStores') || '[]');
            
            let allReviews = [];
            
            // ì¼ë°˜ ë¦¬ë·° ë¡œë“œ
            if (storedReviews) {
                const parsedReviews = JSON.parse(storedReviews);
                allReviews = allReviews.concat(parsedReviews);
            }
            
            // ì—°ê²°ëœ ê°€ê²Œì˜ ë¦¬ë·° ë¡œë“œ (git2)
            if (storedGit2Reviews && connectedStores.length > 0) {
                const parsedGit2Reviews = JSON.parse(storedGit2Reviews);
                const filteredGit2Reviews = parsedGit2Reviews.filter(review => 
                    connectedStores.includes(review.storeId)
                );
                allReviews = allReviews.concat(filteredGit2Reviews);
            }
            
            if (allReviews.length === 0) {
                document.getElementById('pendingCount').textContent = '';
                return;
            }
            
            const pendingReviews = allReviews.filter(review => {
                const hasReplies = review.replies && review.replies.length > 0;
                const hasPendingAutoReply = review.pendingAutoReply && Date.now() < review.pendingAutoReply.scheduledTime;
                return !hasReplies || hasPendingAutoReply;
            });
            
            const count = pendingReviews.length;
            if (count > 0) {
                document.getElementById('pendingCount').textContent = '(' + count + ')';
            } else {
                document.getElementById('pendingCount').textContent = '';
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¦¬ë·° í‘œì‹œ ë° ìë™ ë‹µê¸€ ë¬¸êµ¬, í† ê¸€ ìƒíƒœ, ì§€ì—° ì‹œê°„ ë¡œë“œ
        loadStoreList();
        loadReviews();
        loadAutoReply();
        loadToggleState();
        loadAIToggleState();
        loadDelayState();
        updatePendingCount();
    </script>
</body>
</html>

